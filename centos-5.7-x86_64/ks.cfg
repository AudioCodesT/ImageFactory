# Kickstart file automatically generated by anaconda.

install
cdrom
url --url http://vault.centos.org/5.7/os/x86_64
lang en_US.UTF-8
keyboard us
network --bootproto=dhcp --hostname=packer-centos5
rootpw qwe123
services --disabled="sendmail,postfix" --enabled="sshd,ntpd,ntpdate"

firewall --ssh
authconfig --enableshadow --passalgo=sha512
selinux --disabled
timezone --utc America/New_York
bootloader --location=mbr 
# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work

#part /boot --fstype ext3 --size=100
#part / --fstype ext3 --size=100 --grow
part / --fstype=ext3 --onpart=hda1 --label=root


auth --useshadow --enablemd5
firstboot --disabled
reboot

%packages --nobase --ignoremissing
@Core
# vmbuilder
openssh
openssh-clients
openssh-server
rpm
yum
curl
dhclient
passwd
vim-minimal
sudo
# build kernel module
kernel-devel
gcc
perl
bzip2
# bootstrap
ntp
ntpdate
man
sudo
rsync
git
make
vim-minimal
screen
nmap
lsof
strace
tcpdump
traceroute
telnet
ltrace
bind-utils
sysstat
nc
wireshark
zip
# shared folder
nfs-utils
#
acpid

%pre
dd if=/dev/zero of=/dev/hda bs=512 count=1
parted -s /dev/hda mklabel msdos
parted --script    /dev/hda mklabel msdos
parted --script -- /dev/hda mkpart primary ext3 63s -1

%post
# yum
mkdir -p /etc/yum/vars
echo 5.7 > /etc/yum/vars/releasever

# udev
rm -f /etc/udev/rules.d/70-persistent-net.rules
ln -s /dev/null /etc/udev/rules.d/70-persistent-net.rules

# account:centos
groupadd centos
useradd -g centos -d /home/centos -s /bin/bash -m centos
echo umask 022 >> /home/centos/.bashrc
echo centos:centos | chpasswd
usermod -L root

echo "centos ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers
sed -i "s/^\(^Defaults\s*requiretty\).*/# \1/" /etc/sudoers

# acpi
echo "acpiphp" >> /etc/modules

# ttyS0
echo "S0:2345:respawn:/sbin/agetty ttyS0 115200 linux" >> /etc/inittab
egrep -w "^ttyS0" /etc/securetty || { echo ttyS0 >> /etc/securetty; }

# grub
sed -i 's, rhgb quiet$,,' /boot/grub/grub.conf

# ifcfg-eth0
rm -f /etc/sysconfig/network-scripts/ifcfg-e*
cat <<EOS > /etc/sysconfig/network-scripts/ifcfg-eth0
DEVICE=eth0
TYPE=Ethernet
BOOTPROTO=dhcp
ONBOOT=yes
EOS

%end
